<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ROS on ARM--RK3066上本地编译ROS Groovy | 11zHexo</title>
  <meta name="author" content="E. Sununs">
  
  <meta name="description" content="1. 开源机器人操作系统ROS(Robot Operating System)简介
ROS（Robot Operating System）是一个开源的为机器人软件开发设计的软件框架，在异构计算机集群中提供类似操作系统的功能。它并不是一个计算机的操作系统，而是机器人的操作系统，或者称为元级操作系统（Meta Operating System）。据目前唯一一本比较官方的关于ROS的书《ROS By Example Volume 1》介绍，“The primary goal of ROS (pronounced &quot;Ross&quot;) is to provide a unified and open source
programming framework for controlling robots in a variety of real world and simulated
environments.”，ROS的原始目的就是为了在一系列真实和模拟的环境中控制机器人提供一个统一的开源编程框架。为了实现这一目标，ROS架构中有三个层次的概念：文件系统级（Filesystem Level），计算图级（Computation Graph Level）和社区级（Community Level）。
具体可以查阅维基百科和官网wiki，这里就不过多介绍了。


2. ROS Groovy Galapagos
ROS Groovy Galapagos是2012年12月31日发布的ROS最新版本，主要支持Ubuntu 11.10、Ubuntu 12.04和Ubuntu 12.10。提到这个版本的原因是它采用了新的构建系统——catkin，准备逐渐取代之前的rosbuild。它解决了rosbuild当中的几个问题，让ROS可以持续发展和扩大规模，相对于rosbuild更符合文件系统层次结构标准（Filesystem Hierarchy Standard，FHS），使在其它操作系统和架构上发布ROS包更加容易。正是这个原因让我在MK802 IIIS上编译ROS的时候轻松很多，如果编译之前的版本（比如fuerte）将会遇到更多问题。


因为catkin的引入，ROS文件系统级的Stacks概念被移除了，原因是Package和Stack之间依赖性跟踪出现的问题，取代的是元包（metapackage）的概念。


3. Ubuntu on ARM
ARM版Ubuntu的软件源是在http://ports.ubuntu.com/上，和桌面版的略有区别，我遇到的一个问题就是桌面版python-*的包ARM版几乎都没有，解决办法是使用python的包管理工具pip安装，比如桌面版上apt-get install python-PACKAGENAME，用pip install PACKAGENAME替代。据说easy_install的维护不够好，所以应该尽量用pip。


我使用的是RK3066上的Picuntu，关于Picuntu请看前一篇文章。


4. 编译ROS for ARM">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  <meta property="og:title" content="ROS on ARM--RK3066上本地编译ROS Groovy"/>
  <meta property="og:site_name" content="11zHexo"/>

  <link rel="alternate" href="/atom.xml" title="11zHexo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31707826-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <!--<h1><a href="/">11zHexo</a></h1>-->

  <div id="contenedor">
  <ul class="cube">
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara"></li>
	  <li class="cara">
      <iframe src="/imgs/logo.svg" width="100px" height="100px" frameborder="no">
      </iframe>
    </li>
  </ul>
</div>

<script type="text/javascript">
	$(function(){
		var cube = $('.cube'),
				offset = $('#contenedor').offset(),
				offsetleft = (offset.left + 50),
				offsettop = (offset.top + 50);

		cube.on({
			mousemove: function(e) {
				$(this).css('transform','rotateX(' + (e.pageY - offsettop)*0.618 + 'deg) rotateY(' + (e.pageX - offsetleft)*0.618 + 'deg)');
				$(this).addClass('noanimar').removeClass('animar');
			},
			mouseout: function() {
				$(this).css('transform','rotateX(0deg) rotateY(0deg)');
				$(this).addClass('animar').removeClass('noanimar');
			}
		});
		//console.log('x=' + offsetleft + ', y=' + offsettop);
});
</script>
<script src="/js/prefixfree.min.js"></script>

</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <a href="/"><li>Home</li></a>
    
      <a href="/archives"><li>Archives</li></a>
    
      <a href="/atom.xml"><li>RSS</li></a>
    
  </ul>
  <div class="clearfix"></div>
</nav>


<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">

<article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-02-03T15:08:16.000Z">Feb 3 2013</time>
      
      
  
    <h1 class="title">ROS on ARM--RK3066上本地编译ROS Groovy</h1>
  

    </header>
    <div class="entry">
      
        <h3>1. 开源机器人操作系统ROS(Robot Operating System)简介</h3>
<p>ROS（Robot Operating System）是一个开源的为机器人软件开发设计的软件框架，在异构计算机集群中提供类似操作系统的功能。它并不是一个计算机的操作系统，而是机器人的操作系统，或者称为元级操作系统（Meta Operating System）。据目前唯一一本比较官方的关于ROS的书《ROS By Example Volume 1》介绍，“The primary goal of ROS (pronounced &quot;Ross&quot;) is to provide a unified and open source
programming framework for controlling robots in a variety of real world and simulated
environments.”，ROS的原始目的就是为了在一系列真实和模拟的环境中控制机器人提供一个统一的开源编程框架。为了实现这一目标，ROS架构中有<a href="http://www.ros.org/wiki/ROS/Concepts">三个层次</a>的概念：文件系统级（Filesystem Level），计算图级（Computation Graph Level）和社区级（Community Level）。
具体可以查阅<a href="http://zh.wikipedia.org/wiki/ROS">维基百科</a>和<a href="http://www.ros.org/wiki/">官网wiki</a>，这里就不过多介绍了。

</p>
<h3>2. ROS Groovy Galapagos</h3>
<p><a href="http://www.ros.org/news/2012/12/ros-groovy-galapagos-released.html">ROS Groovy Galapagos</a>是2012年12月31日发布的ROS最新版本，主要支持Ubuntu 11.10、Ubuntu 12.04和Ubuntu 12.10。提到这个版本的原因是它采用了新的构建系统——catkin，准备逐渐取代之前的rosbuild。它解决了rosbuild当中的几个问题，让ROS可以持续发展和扩大规模，相对于rosbuild更符合文件系统层次结构标准（Filesystem Hierarchy Standard，FHS），使在其它操作系统和架构上发布ROS包更加容易。正是这个原因让我在MK802 IIIS上编译ROS的时候轻松很多，如果编译之前的版本（比如fuerte）将会遇到更多问题。

</p>
<p>因为catkin的引入，ROS文件系统级的Stacks概念被移除了，原因是Package和Stack之间依赖性跟踪出现的问题，取代的是元包（metapackage）的概念。

</p>
<h3>3. Ubuntu on ARM</h3>
<p>ARM版Ubuntu的软件源是在<code>http://ports.ubuntu.com/</code>上，和桌面版的略有区别，我遇到的一个问题就是桌面版python-*的包ARM版几乎都没有，解决办法是使用python的包管理工具pip安装，比如桌面版上<code>apt-get install python-PACKAGENAME</code>，用<code>pip install PACKAGENAME</code>替代。据说easy_install的维护不够好，所以应该尽量用pip。

</p>
<p>我使用的是RK3066上的Picuntu，关于Picuntu请看前一篇文章。

</p>
<h3>4. 编译ROS for ARM</h3>
<span id="more"></span>

<p>从前为ARM编译一般都需要在x86的上位机上交叉编译，有一个叫做<a href="http://www.ros.org/wiki/eros">EROS</a>的项目,但是似乎文档不全，个人觉得用它成功编译的人应该也不多。近几年ARM性能足够强了，在ARM运行的操作系统上直接编译也不是什么问题。所以完全可以参考官网<a href="http://ros.org/wiki/groovy/Installation/Source">从源码编译</a>的教程，官网还特别搞了一个<a href="http://ros.org/wiki/groovy/Installation/Raspbian/Source">在树莓派上编译</a>的教程。

</p>
<p>当然，树莓派的内存只有512MB，而且是ARM 11，使用ROS会受到很大的限制，既然它都可以编译ROS Groovy，那么双核A9的RK3066，1G内存就更不是问题了。

</p>
<p>下面一步步按照官网上从源码编译的wiki来：

</p>
<p><strong>4.1 安装基础依赖包</strong>

</p>
<p>操作系统相关的：

</p>
<pre><code><div class="line">su<span class="operator"><span class="keyword">do</span> apt-<span class="keyword">get</span> install build-essential git python-pip </div></code></pre>
<p>ROS Common（或者叫ROS Base，Base Bones什么的）依赖的：

</p>
<pre><code><div class="line">su<span class="operator"><span class="keyword">do</span> apt-<span class="keyword">get</span> install libtinyxml-dev libgtest-dev  liblog4cxx10-dev</div></code></pre>
<p>注意这里只是在Picuntu RC2 上需要额外安装的库，可能你还会遇到其它库的问题。desktop或者desktop-full依赖的库更多，所以更难解决。

</p>
<p>还有一些重要的工具：

</p>
<pre><code><div class="line">su<span class="operator"><span class="keyword">do</span> pip install wstool rospkg rosdep</div></code></pre>
<p>可能会遇到很多<code>python-*</code>的包缺少的问题，需要用<code>sudo pip install PACKAGENAME</code>安装

</p>
<p>安装完rosdep以后初始化一下：

</p>
<pre><code><div class="line">su<span class="operator"><span class="keyword">do</span> rosdep init</div><div class="line">rosdep <span class="keyword">update</span></div></code></pre>
<p><strong>4.2 构建catkin包</strong>

</p>
<p>上面提到过，ROS Galapagos采用了新的构建工具catkin代替rosbuild，但并不是所有的包都转换成了catkin的版本，所以先构建ROS的核心包（使用catkin），然后再构建其余的使用rosbuild的部分。

</p>
<p><strong>4.2.1 创建catkin工作空间</strong>

</p>
<pre><code><div class="line"><span class="title">mkdir</span> ~/ros_catkin_ws</div><div class="line"><span class="title">cd</span> ~/ros_catkin_ws</div></code></pre>
<p>下一步是下载核心包的源码并构建它们，你有三种选择：

</p>
<p>Desktop-Full Install: ROS, rqt, rviz, robot-generic libraries, 2D/3D simulators, navigation and 2D/3D perception

</p>
<pre><code><div class="line">wstool init -j8 src <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/raw/groovy</span><span class="regexp">/desktop-full</div></code></pre>
<p>Desktop Install : ROS, rqt, rviz, and robot-generic libraries

</p>
<pre><code><div class="line">wstool init -j8 src <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/raw/groovy</span><span class="regexp">/desktop-full</div></code></pre>
<p>ROS-Comm: (Bare Bones) ROS package, build, and communication libraries. No GUI tools.

</p>
<pre><code><div class="line">wstool init src -j8 <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/raw/groovy</span><span class="regexp">/ros_comm</div></code></pre>
<p>这个操作是下载catkin包的代码到<code>~/ros_catkin_ws/src</code>目录下，-j8是指并行下载8个包，在RK3066上是无压力的，如果是树莓派可能需要减少。

</p>
<p>注意，在后面解决依赖关系和构建的时候很多包依赖的库可能会缺，你可以根据错误提示自行安装所缺的库。我在MK802 IIIS上只成功编译了ROS-Comm，Desktop编译失败了，而Desktop full在官网wiki中说还有问题：<code>There are build errors in desktop-full (gazebo simulator) at the moment, so the desktop variant is suggested at this time. See: https://code.ros.org/trac/ros-pkg/ticket/5595</code>。

</p>
<p>还可以安装其它的包，如robot：

</p>
<pre><code><div class="line">wstool init -j8 <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/dry/raw</span><span class="regexp">/groovy/robot</span></div></code></pre>
<p>更多的可以在<a href="http://ros.org/reps/rep-0131.html#variants">REP 131</a>中查阅。

</p>
<p><strong>4.2.2 解决依赖关系</strong>

</p>
<p>在构建包之前你必须确保你解决了所有的依赖关系

</p>
<pre><code><div class="line"><span class="comment">rosdep</span> <span class="comment">install</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">from</span>-<span class="comment">paths</span> <span class="comment">src</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">ignore</span>-<span class="comment">src</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">rosdistro</span> <span class="comment">groovy</span> <span class="literal">-</span><span class="comment">y</div></code></pre>
<p><code>--from-paths</code>选项表示我们想要安装某个文件夹下的所有包，这里是<code>src</code>文件夹。<code>--ignore-src</code>选项表示rosdep不应该从包管理器安装任何<code>src</code>文件夹的包，因为我们现在做的就是构建它。<code>--rosdistro</code>选项之所以需要是因为我们没有设置好ROS的环境，所以我们必须指明我们构建的是ROS的哪个版本。最后，<code>-y</code>选项表示出现的提示选择都选择<code>yes</code>

</p>
<p>另外如果你在安装某些包出现错误的情况下仍想安装其它所有可以安装的包，你可以使用-r选项，也就是<code>rosdep install --from-paths src --ignore-src --rosdistro groovy -yr</code>。

</p>
<p><strong>4.2.3 构建catkin工作空间</strong>

</p>
<p>调用<code>catkin_make_isolated</code>:

</p>
<pre><code><div class="line"><span class="string">.</span><span class="comment">/src/catkin/bin/catkin_make_isolated</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">install</div></code></pre>
<p>默认安装在<code>~/ros_catkin_ws/install_isolated</code>下，如果要安装到其它地方，比如<code>/opt/ros/groovy</code>，可以使用<code>--install-space /opt/ros/groovy</code>

</p>
<p>如果编译过程中出现错误提示缺少库，需要自行安装解决。

</p>
<p>如果构建完成了，再执行：

</p>
<pre><code><div class="line"><span class="title">source</span> ~/ros_catkin_ws/install_isolated/setup.bash</div></code></pre>
<p>如果你只需要ROS Common那么就结束了。可以测试一下在终端里输入<code>roscore</code>，我运行的时候报错了，后来注释掉了一个python文件里的几行就跑起来了，具体是哪个文件也忘了，根据报错的信息修改就可以了。

</p>
<p><img src="http://11zpic-11zpic.stor.sinaapp.com/original/f0d3de5d6003319e3bee42370fa2b466.jpg" alt="">

</p>
<p><strong>4.3 构建rosbuild包</strong>

</p>
<p>只构建ROS Common（Bare Bones）是不需要这一步的，在上一步我也没有成功编译desktop，
如果你成功了可以继续下面的步骤：


</p>
<p><strong>4.3.1 创建rosbuild工作空间</strong>

</p>
<pre><code><div class="line"><span class="title">mkdir</span> ~/ros_ws</div><div class="line"><span class="title">cd</span> ~/ros_ws</div><div class="line"><span class="title">rosws</span> init . ~/ros_catkin_ws/install_isolated</div></code></pre>
<p><strong>4.3.2 下载ROS Stacks</strong>

</p>
<p>Desktop-Full Install: 2d/3d simulators, navigation, robot models and several tutorial stacks

</p>
<pre><code><div class="line">rosws merge <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/dry/raw</span><span class="regexp">/groovy/desktop</span>-full</div></code></pre>
<p>Desktop Install: ROS, rqt, rviz, and robot-generic libraries

</p>
<pre><code><div class="line">rosws merge <span class="symbol">http:</span>/<span class="regexp">/packages.ros.org/web</span><span class="regexp">/rosinstall/generate</span><span class="regexp">/dry/raw</span><span class="regexp">/groovy/desktop</span></div></code></pre>
<p>Desktop-Full仍然有问题：<code>There are build errors in desktop-full (gazebo simulator) at the moment, so the desktop variant is suggested at this time. See: https://code.ros.org/trac/ros-pkg/ticket/5595</code>

</p>
<pre><code><div class="line">rosws <span class="operator"><span class="keyword">update</span> -j8</div></code></pre>
<p><strong>4.3.3 构建ROS Stacks</strong>

</p>
<p>下载完后：

</p>
<pre><code><div class="line"><span class="title">source</span> ~/ros_ws/setup.bash</div><div class="line"><span class="title">rosmake</span> -a</div></code></pre>
<h3>5. 其它</h3>
<p>如果你不满足于ROS Common，而且跟我一样没有成功编译desktop的话，可以试试单独编译其它组件，比如OpenCV和PCL。

</p>
<p>OpenCV 2.4.3的编译非常顺利，几乎没有遇到什么障碍，有GTK+2.0，highgui库都可以正常使用。

</p>
<p><img src="http://11zpic-11zpic.stor.sinaapp.com/original/47326a0e384f8fb9d04dcd1eec575f19.jpg" alt="">

</p>
<p>PCL在我去掉少数几个编译选项以后也成功了，pcl_viewer正常工作。//另外我还安装了OpenNI和Kinect驱动

</p>
<p><img src="http://11zpic-11zpic.stor.sinaapp.com/original/d778fdf85992a2e308d31eb2192dbe64.jpg" alt="">

</p>
<p>我编译PCL时的CMakeCache.txt在<a href="https://gist.github.com/4689753">https://gist.github.com/4689753</a>

</p>
<h3>参考资料</h3>
<ol>
<li><a href="http://en.wikipedia.org/wiki/ROS_(Robot_Operating_System)">http://en.wikipedia.org/wiki/ROS_(Robot_Operating_System)</a></li>
<li><a href="http://www.ros.org/wiki/">http://www.ros.org/wiki/</a></li>
<li>R. Patrick Goebel,ROS By Example Volume 1</li>
<li><a href="http://www.ros.org/news/2012/12/ros-groovy-galapagos-released.html">http://www.ros.org/news/2012/12/ros-groovy-galapagos-released.html</a></li>
<li><a href="http://ros.org/wiki/groovy/Installation/Source">http://ros.org/wiki/groovy/Installation/Source</a></li>
<li><a href="http://answers.ros.org/question/10716/ros-on-arm/">http://answers.ros.org/question/10716/ros-on-arm/</a></li>
<li><a href="http://ros.org/wiki/groovy/Installation/Raspbian/Source">http://ros.org/wiki/groovy/Installation/Raspbian/Source</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/ROS/">ROS</a>, <a href="/tags/Linux/">Linux</a>, <a href="/tags/Android/">Android</a>, <a href="/tags/Embedded-Linux/">Embedded Linux</a>, <a href="/tags/ARM/">ARM</a>, <a href="/tags/Robot/">Robot</a>, <a href="/tags/Ubuntu/">Ubuntu</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:sun11.me">
  </form>
</div>




<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <a href="/tags/ARM/"><li>ARM<small>4</small></li></a>
  
    <a href="/tags/Android/"><li>Android<small>4</small></li></a>
  
    <a href="/tags/Customize/"><li>Customize<small>1</small></li></a>
  
    <a href="/tags/Embedded-Linux/"><li>Embedded Linux<small>4</small></li></a>
  
    <a href="/tags/Face-Recognition/"><li>Face Recognition<small>1</small></li></a>
  
    <a href="/tags/Linux/"><li>Linux<small>4</small></li></a>
  
    <a href="/tags/OCR/"><li>OCR<small>1</small></li></a>
  
    <a href="/tags/OpenCV/"><li>OpenCV<small>3</small></li></a>
  
    <a href="/tags/OpenWrt/"><li>OpenWrt<small>1</small></li></a>
  
    <a href="/tags/Qt/"><li>Qt<small>1</small></li></a>
  
    <a href="/tags/ROS/"><li>ROS<small>1</small></li></a>
  
    <a href="/tags/Robot/"><li>Robot<small>4</small></li></a>
  
    <a href="/tags/Ubuntu/"><li>Ubuntu<small>4</small></li></a>
  
    <a href="/tags/Web/"><li>Web<small>1</small></li></a>
  
  </ul>
</div>



</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 E. Sununs
  
  <br />
  Powered by <a href="http://zespia.tw/hexo/">Hexo</a>
</div>
<div class="alignright license">
<img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /> 本站作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh">知识共享署名-非商业性使用-相同方式共享 3.0 未本地化版本许可协议</a>进行许可。
</div>
<div class="clearfix"></div>
</footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = '11zhexo';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>